define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-personas-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins",path:"/plugins",map(){this.route("discourse-ai",(function(){this.route("ai-personas",(function(){this.route("new"),this.route("show",{path:"/:id"})}))}))}}})),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
function i(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends t.default{constructor(){super(...arguments),i(this,"jsonMode",!0)}basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,i){let o=this.basePath(e,t,i)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(o,i)}apiNameFor(){return"ai-persona"}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/models/rest"],(function(e,t,i,o){"use strict"
var s,r
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=["name","description","commands","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","mentionable","default_llm","user","max_context_posts"]
let a=(s=class{constructor(){var e,t,i,o
e=this,t="value",o=this,(i=r)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}},l=s.prototype,u="value",c=[t.tracked],d={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}},m={},Object.keys(d).forEach((function(e){m[e]=d[e]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=c.slice().reverse().reduce((function(e,t){return t(l,u,e)||e}),m),p&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(p):void 0,m.initializer=void 0),void 0===m.initializer&&(Object.defineProperty(l,u,m),m=null),r=m,s)
var l,u,c,d,p,m
class g extends o.default{init(e){e.commands&&(e.commands=e.commands.map((e=>{if("string"==typeof e)return e
{let[t,i]=e
for(let e in i)i.hasOwnProperty(e)&&(this.getCommandOption(t,e).value=i[e])
return t}}))),super.init(e),this.commands=e.commands}async createUser(){const e=await(0,i.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}getCommandOption(e,t){return this.commandOptions||={},this.commandOptions[e]||={},this.commandOptions[e][t]||=new a}populateCommandOptions(e){if(!e.commands)return
let t=[]
e.commands.forEach((e=>{if("string"!=typeof e&&(e=e[0]),this.commandOptions&&this.commandOptions[e]){let i=this.commandOptions[e],o={}
for(let e in i){if(!i.hasOwnProperty(e))continue
let t=i[e]
o[e]=t.value}t.push([e,o])}else t.push(e)})),e.commands=t}updateProperties(){let e=this.getProperties(n)
return e.id=this.id,this.populateCommandOptions(e),e}createProperties(){let e=this.getProperties(n)
return this.populateCommandOptions(e),e}workingCopy(){return g.create(this.createProperties())}}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-panel",["exports","@ember/component","@glimmer/component","@ember/object","@ember/service","I18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/template-factory"],(function(e,t,i,o,s,r,n,a){"use strict"
var l,u,c,d
function p(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function m(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function g(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const b=(0,a.createTemplateFactory)({id:"90vXLYKC",block:'[[[10,0],[14,0,"bot-panel ai-bot-available-bot-options"],[12],[1,"\\n  "],[10,0],[14,0,"menu-panel drop-down"],[12],[1,"\\n    "],[10,0],[14,0,"panel-body"],[12],[1,"\\n      "],[10,0],[14,0,"panel-body-contents"],[12],[1,"\\n        "],[10,0],[14,0,"sidebar-hamburger-dropdown"],[12],[1,"\\n"],[42,[28,[37,1],[[28,[37,1],[[30,0,["botNames"]]],null]],null],null,[[[1,"            "],[8,[39,2],[[24,0,"btn-flat ai-bot-available-bot-content"]],[["@translatedTitle","@translatedLabel","@action"],[[30,1,["humanized"]],[30,1,["humanized"]],[28,[37,3],[[30,0],"composeMessageWithTargetBot",[30,1,["modelName"]]],null]]],null],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["bot"],false,["each","-track-array","d-button","action"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/ai-bot-header-panel.hbs",isStrictMode:!1})
let h=e.default=(d=new WeakSet,l=class extends i.default{constructor(){super(...arguments),m(this,d),p(this,"siteSettings",u,this),p(this,"composer",c,this)}composeMessageWithTargetBot(e){(function(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance")
return i})(this,d,f).call(this,e)}get botNames(){return this.enabledBotOptions.map((e=>({humanized:r.default.t(`discourse_ai.ai_bot.bot_names.${e}`),modelName:e})))}get enabledBotOptions(){return this.siteSettings.ai_bot_enabled_chat_bots.split("|")}},u=g(l.prototype,"siteSettings",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=g(l.prototype,"composer",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g(l.prototype,"composeMessageWithTargetBot",[o.action],Object.getOwnPropertyDescriptor(l.prototype,"composeMessageWithTargetBot"),l.prototype),l)
function f(e){this.args.closePanel(),(0,n.composeAiBotMessage)(e,this.composer)}(0,t.setComponentTemplate)(b,h)})),define("discourse/plugins/discourse-ai/discourse/components/ai-command-selector",["exports","@ember/object","select-kit/components/multi-select"],(function(e,t,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=i.default.extend({_modelDisabledChanged:(0,t.observer)("attrs.disabled",(function(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))})),content:(0,t.computed)((function(){return this.commands})),value:"",selectKitOptions:{filterable:!0}})})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","discourse/components/d-button","discourse-common/helpers/i18n","truth-helpers/helpers/not","@ember/template-factory"],(function(e,t,i,o,s,r,n,a,l,u,c){"use strict"
var d,p,m
function g(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(m=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="_customPromptInput",o=this,(i=p)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}setupCustomPrompt(){this._customPromptInput=document.querySelector(".ai-custom-prompt__input"),this._customPromptInput.focus()}sendInput(){return this.args.submit(this.args.promptArgs)}},(0,o.setComponentTemplate)((0,c.createTemplateFactory)({id:"R9H8RJGc",block:'[[[1,"\\n    "],[11,0],[24,0,"ai-custom-prompt"],[4,[32,0],[[30,0,["setupCustomPrompt"]]],null],[12],[1,"\\n      "],[8,[32,1],[[16,"placeholder",[28,[32,2],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"]],[["@value","@enter"],[[30,1],[30,0,["sendInput"]]]],null],[1,"\\n\\n      "],[8,[32,3],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,4],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@value","@submit","@promptArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[n.default,o.Input,l.default,a.default,s.fn,u.default],isStrictMode:!0}),m),p=g((d=m).prototype,"_customPromptInput",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g(d.prototype,"setupCustomPrompt",[r.action],Object.getOwnPropertyDescriptor(d.prototype,"setupCustomPrompt"),d.prototype),g(d.prototype,"sendInput",[r.action],Object.getOwnPropertyDescriptor(d.prototype,"sendInput"),d.prototype),d)})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-common/helpers/i18n","@ember/template-factory","@ember/component","@ember/component/template-only"],(function(e,t,i,o,s,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,s.setComponentTemplate)((0,o.createTemplateFactory)({id:"Av2n/cr8",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-helper-context-menu__loading"],[12],[1,"\\n    "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n    "],[10,1],[12],[1,"\\n      "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["times","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"]],["@cancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[i.default,t.default],isStrictMode:!0}),(0,r.default)())
e.default=n})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/object","discourse-i18n","select-kit/components/combo-box"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=o.default.extend({_modelDisabledChanged:(0,t.observer)("attrs.disabled",(function(){this.selectKit.options.set("disabled",this.get("attrs.disabled.value"))})),content:(0,t.computed)((function(){return[{id:"blank",name:i.default.t("discourse_ai.ai_persona.no_llm_selected")}].concat(this.llms)})),selectKitOptions:{filterable:!0}})})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-command-option-editor",["exports","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,t.setComponentTemplate)((0,i.createTemplateFactory)({id:"WHtmf9wt",block:'[[[1,"\\n  "],[10,0],[14,0,"control-group ai-persona-command-option-editor"],[12],[1,"\\n    "],[10,"label"],[12],[1,"\\n      "],[1,[30,1,["name"]]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,""],[12],[1,"\\n      "],[8,[32,0],null,[["@value"],[[30,1,["value","value"]]]],null],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"ai-persona-command-option-editor__instructions"],[12],[1,"\\n      "],[1,[30,1,["description"]]],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@option"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-command-option-editor.js",scope:()=>[t.Input],isStrictMode:!0}),(0,o.default)())
e.default=s})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-command-options",["exports","@glimmer/component","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-command-option-editor","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r){"use strict"
var n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{get showCommandOptions(){const e=this.args.allCommands
return!!e&&this.commandNames.any((t=>e.find((e=>e.id===t))?.options))}get commandNames(){return this.args.commands?this.args.commands.map((e=>"string"==typeof e?e:e[0])):[]}get commandOptions(){if(!this.args.commands)return[]
const e=this.args.allCommands
if(!e)return[]
const t=[]
return this.commandNames.forEach((i=>{const o=e.find((e=>e.id===i)),s=o?.name,r=o?.options
if(r){const e=Object.keys(r).map((e=>{const t=this.args.persona.getCommandOption(i,e)
return Object.assign({},r[e],{id:e,value:t})}))
t.push({commandName:s,options:e})}})),t}}e.default=a,n=a,(0,r.setComponentTemplate)((0,s.createTemplateFactory)({id:"4ZSHKwgK",block:'[[[1,"\\n"],[41,[30,0,["showCommandOptions"]],[[[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.command_options"],null]],[13],[1,"\\n        "],[10,0],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["commandOptions"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"ai-persona-editor__command-options"],[12],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__command-options-name"],[12],[1,"\\n                "],[1,[30,1,["commandName"]]],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-persona-editor__command-option-options"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,1,["options"]]],null]],null],null,[[[1,"                  "],[8,[32,1],null,[["@option"],[[30,2]]],null],[1,"\\n"]],[2]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["commandOption","option"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-command-options.js",scope:()=>[i.default,o.default],isStrictMode:!0}),n)})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/runloop","@ember/service","discourse/components/d-button","discourse/components/d-textarea","discourse/components/d-toggle-switch","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/models/group","discourse-i18n","admin/models/admin-user","select-kit/components/group-chooser","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-command-selector","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-command-options","@ember/template-factory"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m,g,b,h,f,y,_,v,w,S,P,j){"use strict"
var O,x,z,T,M,k,A,E,C,I,N
function R(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function D(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function L(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance")
return i}function B(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(N=new WeakSet,I=class extends t.default{constructor(){super(...arguments),D(this,N),R(this,"router",x,this),R(this,"store",z,this),R(this,"dialog",T,this),R(this,"toasts",M,this),R(this,"allGroups",k,this),R(this,"isSaving",A,this),R(this,"editingModel",E,this),R(this,"showDelete",C,this)}updateModel(){this.editingModel=this.args.model.workingCopy(),this.showDelete=!this.args.model.isNew&&!this.args.model.system}async updateAllGroups(){this.allGroups=await h.default.findAll()}async save(){const e=this.args.model.isNew
this.isSaving=!0
const t=this.args.model.workingCopy()
this.args.model.setProperties(this.editingModel)
try{await this.args.model.save(),L(this,N,U).call(this),e?(this.args.personas.addObject(this.args.model),this.router.transitionTo("adminPlugins.discourse-ai.ai-personas.show",this.args.model)):this.toasts.success({data:{message:f.default.t("discourse_ai.ai_persona.saved")},duration:2e3})}catch(i){this.args.model.setProperties(t),(0,b.popupAjaxError)(i)}finally{(0,u.later)((()=>{this.isSaving=!1}),1e3)}}get showTemperature(){return this.editingModel?.temperature||!this.editingModel?.system}get showTopP(){return this.editingModel?.top_p||!this.editingModel?.system}get adminUser(){return y.default.create(this.editingModel?.user)}get mappedDefaultLlm(){return this.editingModel?.default_llm||"blank"}set mappedDefaultLlm(e){this.editingModel.default_llm="blank"===e?null:e}delete(){return this.dialog.confirm({message:f.default.t("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.personas.removeObject(this.args.model),this.router.transitionTo("adminPlugins.discourse-ai.ai-personas.index")}))})}updateAllowedGroups(e){this.editingModel.set("allowed_group_ids",e)}async toggleEnabled(){await this.toggleField("enabled")}async togglePriority(){await this.toggleField("priority",!0)}async toggleMentionable(){await this.toggleField("mentionable")}async createUser(){try{let e=await this.args.model.createUser()
this.editingModel.set("user",e),this.editingModel.set("user_id",e.id)}catch(e){(0,b.popupAjaxError)(e)}}async toggleField(e,t){if(this.args.model.set(e,!this.args.model[e]),this.editingModel.set(e,this.args.model[e]),!this.args.model.isNew)try{const i={}
i[e]=this.args.model[e],await this.args.model.update(i),t&&L(this,N,U).call(this)}catch(i){(0,b.popupAjaxError)(i)}}},(0,o.setComponentTemplate)((0,j.createTemplateFactory)({id:"TDePBDmh",block:'[[[1,"\\n    "],[11,"form"],[24,0,"form-horizontal ai-persona-editor"],[4,[32,0],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,1],[[30,0,["updateModel"]],[30,1,["id"]]],null],[4,[32,1],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[8,[32,2],[[24,0,"ai-persona-editor__enabled"],[4,[32,3],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,1,["enabled"]],"discourse_ai.ai_persona.enabled"]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group ai-persona-editor__priority"],[12],[1,"\\n        "],[8,[32,2],[[24,0,"ai-persona-editor__priority"],[4,[32,3],["click",[30,0,["togglePriority"]]],null]],[["@state","@label"],[[30,1,["priority"]],"discourse_ai.ai_persona.priority"]],null],[1,"\\n        "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.priority_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"        "],[10,0],[14,0,"control-group ai-persona-editor__mentionable"],[12],[1,"\\n          "],[8,[32,2],[[24,0,"ai-persona-editor__mentionable_toggle"],[4,[32,3],["click",[30,0,["toggleMentionable"]]],null]],[["@state","@label"],[[30,1,["mentionable"]],"discourse_ai.ai_persona.mentionable"]],null],[1,"\\n          "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.mentionable_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n        "],[8,[32,6],[[24,0,"ai-persona-editor__name"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["text",[30,0,["editingModel","name"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.description"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,0,"ai-persona-editor__description"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","description"]]]],null],[1,"      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.default_llm"],null]],[13],[1,"\\n        "],[8,[32,8],[[24,0,"ai-persona-editor__llms"]],[["@value","@llms"],[[30,0,["mappedDefaultLlm"]],[30,2,["resultSetMeta","llms"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.default_llm_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.user"],null]],[13],[1,"\\n"],[41,[30,0,["editingModel","user"]],[[[1,"            "],[10,3],[14,0,"avatar"],[15,6,[30,0,["editingModel","user","path"]]],[15,"data-user-card",[30,0,["editingModel","user","username"]]],[12],[1,"\\n              "],[1,[28,[32,9],[[30,0,["editingModel","user","avatar_template"]],"small"],null]],[1,"\\n            "],[13],[1,"\\n            "],[8,[32,10],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n              "],[1,[30,0,["editingModel","user","username"]]],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],[[[1,"            "],[8,[32,11],[[24,0,"ai-persona-editor__create-user"]],[["@action"],[[30,0,["createUser"]]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.create_user"],null]],[1,"\\n            "]],[]]]]],[1,"\\n            "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.create_user_help"],null]]],null],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.commands"],null]],[13],[1,"\\n        "],[8,[32,12],[[24,0,"ai-persona-editor__commands"]],[["@value","@disabled","@commands"],[[30,0,["editingModel","commands"]],[30,0,["editingModel","system"]],[30,2,["resultSetMeta","commands"]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[51,[30,0,["editingModel","system"]]],[[[1,"        "],[8,[32,13],null,[["@persona","@commands","@allCommands"],[[30,0,["editingModel"]],[30,0,["editingModel","commands"]],[30,2,["resultSetMeta","commands"]]]],null],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.allowed_groups"],null]],[13],[1,"\\n        "],[8,[32,14],null,[["@value","@content","@onChange"],[[30,0,["editingModel","allowed_group_ids"]],[30,0,["allGroups"]],[30,0,["updateAllowedGroups"]]]],null],[1,"\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[14,"for","ai-persona-editor__system_prompt"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.system_prompt"],null]],[13],[1,"\\n        "],[8,[32,7],[[24,0,"ai-persona-editor__system_prompt"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@value"],[[30,0,["editingModel","system_prompt"]]]],null],[1,"      "],[13],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.max_context_posts"],null]],[13],[1,"\\n        "],[8,[32,6],[[24,0,"ai-persona-editor__max_context_posts"]],[["@type","@value"],["number",[30,0,["editingModel","max_context_posts"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.max_context_posts_help"],null]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["showTemperature"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.temperature"],null]],[13],[1,"\\n          "],[8,[32,6],[[24,0,"ai-persona-editor__temperature"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","temperature"]]]],null],[1,"\\n          "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.temperature_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[41,[30,0,["showTopP"]],[[[1,"        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.top_p"],null]],[13],[1,"\\n          "],[8,[32,6],[[24,0,"ai-persona-editor__top_p"],[16,"disabled",[30,0,["editingModel","system"]]]],[["@type","@value"],["number",[30,0,["editingModel","top_p"]]]],null],[1,"\\n          "],[8,[32,4],null,[["@icon","@content"],["question-circle",[28,[32,5,["t"]],["discourse_ai.ai_persona.top_p_help"],null]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"      "],[10,0],[14,0,"control-group ai-persona-editor__action_panel"],[12],[1,"\\n        "],[8,[32,11],[[24,0,"btn-primary ai-persona-editor__save"]],[["@action","@disabled"],[[30,0,["save"]],[30,0,["isSaving"]]]],[["default"],[[[[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.save"],null]]],[]]]]],[1,"\\n"],[41,[30,0,["showDelete"]],[[[1,"          "],[8,[32,11],[[24,0,"btn-danger ai-persona-editor__delete"]],[["@action"],[[30,0,["delete"]]]],[["default"],[[[[1,"\\n            "],[1,[28,[32,5,["t"]],["discourse_ai.ai_persona.delete"],null]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@model","@personas"],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[a.default,n.default,m.default,s.on,v.default,f.default,o.Input,p.default,S.default,g.default,l.LinkTo,d.default,w.default,P.default,_.default],isStrictMode:!0}),I),x=B((O=I).prototype,"router",[c.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=B(O.prototype,"store",[c.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=B(O.prototype,"dialog",[c.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=B(O.prototype,"toasts",[c.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=B(O.prototype,"allGroups",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=B(O.prototype,"isSaving",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E=B(O.prototype,"editingModel",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=B(O.prototype,"showDelete",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B(O.prototype,"updateModel",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"updateModel"),O.prototype),B(O.prototype,"updateAllGroups",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"updateAllGroups"),O.prototype),B(O.prototype,"save",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"save"),O.prototype),B(O.prototype,"delete",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"delete"),O.prototype),B(O.prototype,"updateAllowedGroups",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"updateAllowedGroups"),O.prototype),B(O.prototype,"toggleEnabled",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"toggleEnabled"),O.prototype),B(O.prototype,"togglePriority",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"togglePriority"),O.prototype),B(O.prototype,"toggleMentionable",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"toggleMentionable"),O.prototype),B(O.prototype,"createUser",[r.action],Object.getOwnPropertyDescriptor(O.prototype,"createUser"),O.prototype),O)
function U(){const e=this.args.personas.toArray().sort(((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name)))
this.args.personas.clear(),this.args.personas.setObjects(e)}})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/routing","discourse/helpers/concat-class","discourse/lib/text","discourse-common/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c){"use strict"
var d,p,m
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(m=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="_noPersonaText",o=this,(i=p)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}get noPersonaText(){if(null===this._noPersonaText){const e=a.default.t("discourse_ai.ai_persona.no_persona_selected");(0,r.cook)(e).then((e=>{this._noPersonaText=e}))}return this._noPersonaText}},(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"ZGQwJcK9",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-persona-list-editor__header"],[12],[1,"\\n      "],[10,"h3"],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.title"],null]],[13],[1,"\\n"],[41,[51,[30,1,["isNew"]]],[[[1,"        "],[8,[32,1],[[24,0,"btn btn-primary"]],[["@route"],["adminPlugins.discourse-ai.ai-personas.new"]],[["default"],[[[[1,"\\n          "],[1,[28,[32,2],["plus"],null]],[1,"\\n          "],[10,1],[12],[1,[28,[32,0,["t"]],["discourse_ai.ai_persona.new"],null]],[13],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n    "],[10,0],[14,0,"content-list ai-persona-list-editor"],[12],[1,"\\n      "],[10,"ul"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"          "],[10,"li"],[15,0,[28,[32,3],[[52,[30,3,["enabled"]],"","diabled"],[52,[30,3,["priority"]],"priority"]],null]],[12],[1,"\\n            "],[8,[32,1],[[24,"current-when","true"]],[["@route","@model"],["adminPlugins.discourse-ai.ai-personas.show",[30,3]]],[["default"],[[[[1,[30,3,["name"]]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n    "],[10,"section"],[14,0,"ai-persona-list-editor__current content-body"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,4],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"ai-persona-list-editor__empty"],[12],[1,"\\n          "],[1,[30,0,["noPersonaText"]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentPersona","@personas","persona"],false,["unless","each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[a.default,o.LinkTo,n.default,s.default,l.default],isStrictMode:!0}),m),g=(d=m).prototype,b="_noPersonaText",h=[i.tracked],f={configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}},_={},Object.keys(f).forEach((function(e){_[e]=f[e]})),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=h.slice().reverse().reduce((function(e,t){return t(g,b,e)||e}),_),y&&void 0!==_.initializer&&(_.value=_.initializer?_.initializer.call(y):void 0,_.initializer=void 0),void 0===_.initializer&&(Object.defineProperty(g,b,_),_=null),p=_,d)
var g,b,h,f,y,_})),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m,g){"use strict"
var b,h,f,y,_,v,w
function S(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function P(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function j(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(w=class extends t.default{constructor(){super(...arguments),S(this,"site",h,this),S(this,"menu",f,this),S(this,"suggestions",y,this),S(this,"loading",_,this),S(this,"icon",v,this),P(this,"SUGGESTION_TYPES",{title:"suggest_title",category:"suggest_category",tag:"suggest_tags"})}get input(){return this.args.selectedPosts.map((e=>e.cooked)).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,u.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then((e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map((e=>e.name)),i=this.site.categories.filter((e=>t.includes(e.name.toLowerCase())))
this.suggestions=i}else this.suggestions=e.assistant.map((e=>e.name))})).catch(c.popupAjaxError).finally((()=>{this.loading=!1})))}applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else{const t=[this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else this.args.updateAction(e)
return t.close()}}}},(0,g.setComponentTemplate)((0,m.createTemplateFactory)({id:"OK/TJTRS",block:'[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[1,"    "],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n      "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"              "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n                "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[3,4]],null]],[]],null],[1,"      "],[13],[1,"\\n    "]],[2]]]]],[1,"\\n  "]],["@mode","menu","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[a.default,d.default,s.on,p.default,o.fn,l.default],isStrictMode:!0}),w),h=j((b=w).prototype,"site",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=j(b.prototype,"menu",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=j(b.prototype,"suggestions",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=j(b.prototype,"loading",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),v=j(b.prototype,"icon",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"discourse-sparkles"}}),j(b.prototype,"loadSuggestions",[r.action],Object.getOwnPropertyDescriptor(b.prototype,"loadSuggestions"),b.prototype),j(b.prototype,"applySuggestion",[r.action],Object.getOwnPropertyDescriptor(b.prototype,"applySuggestion"),b.prototype),b)})),define("discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse-common/utils/decorators","I18n","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m){"use strict"
var g,b,h,f,y,_,v,w,S,P,j,O,x,z,T
function M(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function k(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function A(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function E(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance")
return i}function C(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(O=new WeakSet,x=new WeakSet,z=new WeakSet,T=new WeakSet,j=class extends t.default{constructor(){super(...arguments),k(this,T),k(this,z),k(this,x),k(this,O),M(this,"dialog",b,this),M(this,"siteSettings",h,this),M(this,"composer",f,this),M(this,"loading",y,this),M(this,"showMenu",_,this),M(this,"generatedSuggestions",v,this),M(this,"suggestIcon",w,this),M(this,"showErrors",S,this),M(this,"error",P,this),A(this,"SUGGESTION_TYPES",{title:"suggest_title",category:"suggest_category",tag:"suggest_tags"})}willDestroy(){super.willDestroy(...arguments),document.removeEventListener("click",this.onClickOutside)}get showAIButton(){const e=this.composer.model.replyLength>40,t=document.querySelector(".composer-fields")
return t&&(e?t.classList.add("showing-ai-suggestions"):t.classList.remove("showing-ai-suggestions")),e}get disableSuggestionButton(){return this.loading}applyClasses(){this.showAIButton?document.querySelector(".composer-fields")?.classList.add("showing-ai-suggestions"):document.querySelector(".composer-fields")?.classList.remove("showing-ai-suggestions")}onClickOutside(e){const t=document.querySelector(".ai-title-suggestions-menu")
if(e.target!==t)return E(this,O,I).call(this)}handleClickOutside(){document.addEventListener("click",this.onClickOutside)}applySuggestion(e){if(!this.args.mode)return
const t=this.args?.composer
if(t){if(this.args.mode===this.SUGGESTION_TYPES.title)return t.set("title",e),E(this,O,I).call(this)
if(this.args.mode===this.SUGGESTION_TYPES.category){const i=this.composer.categories.find((t=>t.slug===e)).id
return t.set("categoryId",i),E(this,O,I).call(this)}this.args.mode===this.SUGGESTION_TYPES.tag&&E(this,x,N).call(this,e,t)}}async performSuggestion(){if(this.args.mode)return 0===this.composer.model.replyLength?this.dialog.alert(d.default.t("discourse_ai.ai_helper.missing_content")):(this.loading=!0,this.suggestIcon="spinner",(0,l.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.composer.model.reply}}).then((e=>{E(this,T,D).call(this,e,this.args.mode)})).catch(u.popupAjaxError).finally((()=>{this.loading=!1,this.suggestIcon="sync-alt",this.showMenu=!0,"suggest_category"===this.args.mode&&document.querySelector(".category-input")?.classList.add("showing-ai-suggestion-menu")})))}},(0,m.setComponentTemplate)((0,p.createTemplateFactory)({id:"Cn6HectJ",block:'[[[1,"\\n"],[41,[30,0,["showAIButton"]],[[[1,"      "],[8,[32,0],[[16,0,[29,["suggestion-button ",[52,[30,0,["loading"]],"is-loading"]]]],[17,1]],[["@icon","@title","@action","@disabled"],[[30,0,["suggestIcon"]],"discourse_ai.ai_helper.suggest",[30,0,["performSuggestion"]],[30,0,["disableSuggestionButton"]]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showMenu"]],[[[1,"      "],[11,"ul"],[24,0,"popup-menu ai-suggestions-menu"],[4,[32,1],[[30,0,["handleClickOutside"]]],null],[12],[1,"\\n"],[41,[30,0,["showErrors"]],[[[1,"          "],[10,"li"],[14,0,"ai-suggestions-menu__errors"],[12],[1,[30,0,["error"]]],[13],[1,"\\n"]],[]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["generatedSuggestions"]]],null]],null],null,[[[1,"          "],[10,"li"],[15,"data-name",[30,2]],[15,"data-value",[30,3]],[12],[1,"\\n            "],[8,[32,0],[[24,0,"popup-menu-btn"]],[["@translatedLabel","@action"],[[30,2],[28,[32,2],[[30,0,["applySuggestion"]],[30,2]],null]]],null],[1,"\\n          "],[13],[1,"\\n"]],[2,3]],null],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["&attrs","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown.js",scope:()=>[a.default,r.default,o.fn],isStrictMode:!0}),j),b=C((g=j).prototype,"dialog",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=C(g.prototype,"siteSettings",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=C(g.prototype,"composer",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=C(g.prototype,"loading",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=C(g.prototype,"showMenu",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),v=C(g.prototype,"generatedSuggestions",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),w=C(g.prototype,"suggestIcon",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"discourse-sparkles"}}),S=C(g.prototype,"showErrors",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),P=C(g.prototype,"error",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C(g.prototype,"applyClasses",[s.action],Object.getOwnPropertyDescriptor(g.prototype,"applyClasses"),g.prototype),C(g.prototype,"onClickOutside",[c.bind],Object.getOwnPropertyDescriptor(g.prototype,"onClickOutside"),g.prototype),C(g.prototype,"handleClickOutside",[s.action],Object.getOwnPropertyDescriptor(g.prototype,"handleClickOutside"),g.prototype),C(g.prototype,"applySuggestion",[s.action],Object.getOwnPropertyDescriptor(g.prototype,"applySuggestion"),g.prototype),C(g.prototype,"performSuggestion",[s.action],Object.getOwnPropertyDescriptor(g.prototype,"performSuggestion"),g.prototype),g)
function I(){this.showMenu&&"suggest_category"===this.args.mode&&document.querySelector(".category-input")?.classList.remove("showing-ai-suggestion-menu"),this.suggestIcon="discourse-sparkles",this.showMenu=!1,this.showErrors=!1,this.errors=""}function N(e,t){const i=this.siteSettings.max_tags_per_topic
if(!t.tags)return t.set("tags",[e]),void(this.generatedSuggestions=this.generatedSuggestions.filter((t=>t!==e)))
const o=t.tags
return o?.length>=i?(this.showErrors=!0,void(this.error=d.default.t("select_kit.max_content_reached",{count:i}))):(o.push(e),t.set("tags",[...o]),this.generatedSuggestions=this.generatedSuggestions.filter((t=>t!==e)))}function R(){return this.args.composer?.tags&&this.args.composer?.tags.length>0}function D(e,t){if(t===this.SUGGESTION_TYPES.title)return this.generatedSuggestions=e.suggestions
const i=e.assistant.map((e=>e.name))
return t===this.SUGGESTION_TYPES.tag&&E(this,z,R).call(this)?this.generatedSuggestions=i.filter((e=>!this.args.composer.tags.includes(e))):this.generatedSuggestions=i}})),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@ember/object","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse-common/helpers/i18n","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l){"use strict"
var u,c
function d(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(c=class extends t.default{triggerConfirmChanges(){this.args.closeModal(),this.args.confirm()}triggerRevertChanges(){this.args.closeModal(),this.args.revert()}},(0,l.setComponentTemplate)((0,a.createTemplateFactory)({id:"tqHStVL1",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[41,[30,2],[[[1,"          "],[1,[28,[32,2],[[30,2]],null]],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,"\\n            "],[1,[30,3]],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n            "],[1,[30,4]],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary confirm"]],[["@action","@label"],[[30,0,["triggerConfirmChanges"]],"discourse_ai.ai_helper.context_menu.confirm"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn-flat"]],[["@action","@label"],[[30,0,["triggerRevertChanges"]],"discourse_ai.ai_helper.context_menu.revert"]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@diff","@oldValue","@newValue"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[r.default,n.default,o.htmlSafe,s.default],isStrictMode:!0}),c),d((u=c).prototype,"triggerConfirmChanges",[i.action],Object.getOwnPropertyDescriptor(u.prototype,"triggerConfirmChanges"),u.prototype),d(u.prototype,"triggerRevertChanges",[i.action],Object.getOwnPropertyDescriptor(u.prototype,"triggerRevertChanges"),u.prototype),u)})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse-common/helpers/i18n","discourse-common/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m){"use strict"
var g,b,h,f,y,_,v
function w(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function S(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(v=class extends t.default{constructor(){super(...arguments),w(this,"contextValue",b,this),w(this,"htmlContext",h,this),w(this,"maxContext",f,this),w(this,"allPosts",y,this),w(this,"justCopiedText",_,this)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let i=1;i<=this.args.model.post_number;i++)t.push(i)
this.allPosts=t.map((t=>{let i=e.findPostIdForPostNumber(t)
if(i)return e.findLoadedPost(i)})).filter((e=>e)),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const i=this.allPosts[t]
e.push(`<p><b>${i.username}:</b></p>`),e.push(i.cooked)}this.htmlContext=(0,n.htmlSafe)(e.join("\n"))}async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,p.default)(this.args.model.topic,e,t),this.justCopiedText=d.default.t("discourse_ai.ai_bot.conversation_shared"),(0,c.default)((()=>{this.justCopiedText=""}),2e3)}},(0,o.setComponentTemplate)((0,m.createTemplateFactory)({id:"pMctz3Jd",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n          "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n          "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n            "],[1,[30,0,["contextValue"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[l.default,u.default,o.Input,s.on,a.default],isStrictMode:!0}),v),b=S((g=v).prototype,"contextValue",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),h=S(g.prototype,"htmlContext",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),f=S(g.prototype,"maxContext",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y=S(g.prototype,"allPosts",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=S(g.prototype,"justCopiedText",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),S(g.prototype,"updateHtmlContext",[r.action],Object.getOwnPropertyDescriptor(g.prototype,"updateHtmlContext"),g.prototype),S(g.prototype,"copyContext",[r.action],Object.getOwnPropertyDescriptor(g.prototype,"copyContext"),g.prototype),g)})),define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c){"use strict"
var d,p,m
function g(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(m=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="selectedImages",o=this,(i=p)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}get isDisabled(){return 0===this.selectedImages.length}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter((e=>{if(e!==t)return e}))}appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}},(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"rVPkxzzs",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2]],null]],null],null,[[[1,"            "],[8,[32,2],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,3],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n        "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@thumbnails","thumbnail"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[r.default,a.default,l.default,s.default,n.default],isStrictMode:!0}),m),p=g((d=m).prototype,"selectedImages",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),g(d.prototype,"addSelection",[o.action],Object.getOwnPropertyDescriptor(d.prototype,"addSelection"),d.prototype),g(d.prototype,"removeSelection",[o.action],Object.getOwnPropertyDescriptor(d.prototype,"removeSelection"),d.prototype),g(d.prototype,"appendSelectedImages",[o.action],Object.getOwnPropertyDescriptor(d.prototype,"appendSelectedImages"),d.prototype),d)})),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,o.createTemplateFactory)({id:"r8usWg+W",block:'[[[41,[30,1],[[[1,"  "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[37,2],[[30,1]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,3],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],false,["if","each","-each-in","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/model-accuracies.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(s,(0,i.default)())})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@ember/component","@glimmer/component","discourse/plugins/chat/discourse/models/chat-channel","@ember/template-factory"],(function(e,t,i,o,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=(0,s.createTemplateFactory)({id:"yKOx21Wk",block:'[[[41,[30,0,["chatChannel"]],[[[1,"  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[39,1],null,[["@route","@models"],["chat.channel.near-message",[28,[37,2],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n      "],[8,[39,3],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,4],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,5],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n      "],[1,[28,[35,6],[[28,[37,7],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,9],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["if","link-to","array","chat-channel-title","reviewable-created-by","reviewable-post-header","html-safe","or","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.hbs",isStrictMode:!1})
class n extends i.default{get chatChannel(){if(this.args.reviewable.chat_channel)return o.default.create(this.args.reviewable.chat_channel)}}e.default=n,(0,t.setComponentTemplate)(r,n)})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const s=(0,o.createTemplateFactory)({id:"XJ3JIp4P",block:'[[[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n  "],[8,[39,0],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n  "],[8,[39,1],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,2],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,3],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"        "],[10,2],[12],[1,[28,[35,5],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,6],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,8],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["reviewable-topic-link","reviewable-post-edits","reviewable-created-by","reviewable-post-header","if","i18n","html-safe","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(s,(0,i.default)())})),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a){"use strict"
var l,u,c,d,p
function m(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function g(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(p=class extends t.default{constructor(){super(...arguments),m(this,"selected",u,this),m(this,"selectIcon",c,this),m(this,"selectLabel",d,this)}toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="check-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}},(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"BsBgpDKw",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n      "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n      "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@thumbnail"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[r.default,o.fn],isStrictMode:!0}),p),u=g((l=p).prototype,"selected",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=g(l.prototype,"selectIcon",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"far-circle"}}),d=g(l.prototype,"selectLabel",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"}}),g(l.prototype,"toggleSelection",[s.action],Object.getOwnPropertyDescriptor(l.prototype,"toggleSelection"),l.prototype),l)})),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-common/helpers/i18n","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r){"use strict"
var n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}}e.default=a,n=a,(0,r.setComponentTemplate)((0,s.createTemplateFactory)({id:"aCrw9598",block:'[[[1,"\\n    "],[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[i.LinkTo,o.default],isStrictMode:!0}),n)})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n){"use strict"
var a,l,u
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(u=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="siteSettings",o=this,(i=l)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}static shouldRender(e,t){return(0,s.showComposerAIHelper)(e,t,"suggestions")}},(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"tgy79Whv",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],[[24,0,"suggest-category-button"]],[["@mode","@composer"],["suggest_category",[30,1,["composer"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[o.default],isStrictMode:!0}),u),c=(a=u).prototype,d="siteSettings",p=[i.inject],m={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(m).forEach((function(e){b[e]=m[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,d,e)||e}),b),g&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(g):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,d,b),b=null),l=b,a)
var c,d,p,m,g,b})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n){"use strict"
var a,l,u
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(u=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="siteSettings",o=this,(i=l)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}static shouldRender(e,t){return(0,s.showComposerAIHelper)(e,t,"suggestions")}},(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"qB6wq01S",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],[[24,0,"suggest-tags-button"]],[["@mode","@composer"],["suggest_tags",[30,1,["composer"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[o.default],isStrictMode:!0}),u),c=(a=u).prototype,d="siteSettings",p=[i.inject],m={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(m).forEach((function(e){b[e]=m[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,d,e)||e}),b),g&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(g):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,d,b),b=null),l=b,a)
var c,d,p,m,g,b})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-suggestion-dropdown","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r){"use strict"
var n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,o.showComposerAIHelper)(e,t,"suggestions")}}e.default=a,n=a,(0,r.setComponentTemplate)((0,s.createTemplateFactory)({id:"4En7i5/x",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"suggest-titles-button"]],[["@mode","@composer"],["suggest_title",[30,1,["composer"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),n)})),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/ai-helper-context-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","@popperjs/core","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/config/environment","discourse-common/utils/decorators","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],(function(e,t,i,o,s,r,n,a,l,u,c,d){"use strict"
var p,m,g,b,h,f,y,_,v,w,S,P,j,O,x,z,T,M,k,A,E,C,I,N,R,D,L,B,U
function q(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function F(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function G(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(p=(0,c.debounce)(u.INPUT_DELAY),m=class extends t.default{constructor(){super(...arguments),q(this,"currentUser",g,this),q(this,"siteSettings",b,this),q(this,"modal",h,this),q(this,"capabilities",f,this),q(this,"showContextMenu",y,this),q(this,"caretCoords",_,this),q(this,"virtualElement",v,this),q(this,"selectedText",w,this),q(this,"newSelectedText",S,this),q(this,"loading",P,this),q(this,"lastUsedOption",j,this),q(this,"showDiffModal",O,this),q(this,"showThumbnailModal",x,this),q(this,"diff",z,this),q(this,"popperPlacement",T,this),q(this,"previousMenuState",M,this),q(this,"customPromptValue",k,this),q(this,"initialValue",A,this),q(this,"thumbnailSuggestions",E,this),q(this,"selectionRange",C,this),q(this,"lastSelectionRange",I,this),F(this,"CONTEXT_MENU_STATES",{triggers:"TRIGGERS",options:"OPTIONS",resets:"RESETS",loading:"LOADING",review:"REVIEW"}),F(this,"prompts",[]),F(this,"promptTypes",{}),F(this,"minSelectionChars",3),q(this,"_menuState",N,this),q(this,"_popper",R,this),q(this,"_dEditorInput",D,this),q(this,"_customPromptInput",L,this)
q(this,"_contextMenu",B,this),q(this,"_activeAIRequest",U,this)}static shouldRender(e,t){return(0,d.showComposerAIHelper)(e,t,"context_menu")}willDestroy(){super.willDestroy(...arguments),document.removeEventListener("selectionchange",this.selectionChanged),document.removeEventListener("keydown",this.onKeyDown),this._popper?.destroy()}get menuState(){return this._menuState}set menuState(e){this.previousMenuState=this._menuState,this._menuState=e}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("composer"))).filter((e=>"generate_titles"!==e.name))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const i=e.splice(t,1)[0]
e.unshift(i)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),e.forEach((e=>{this.prompts[e.id]=e})),this.promptTypes=e.reduce(((e,t)=>(e[t.name]=t.prompt_type,e)),{}),e}selectionChanged(){if(document.activeElement!==this._dEditorInput)return
const e=Boolean(window.getSelection()&&document.activeElement&&document.activeElement.value)
this.selectedText=e?document.activeElement.value.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd):"",this.selectionRange=e?{x:document.activeElement.selectionStart,y:document.activeElement.selectionEnd}:{x:0,y:0},0!==this.selectedText?.length?this.selectedText?.length<this.minSelectionChars||this._onSelectionChanged():this.closeContextMenu()}updatePosition(){this.showContextMenu&&this.positionContextMenu()}onKeyDown(e){return"Escape"===e.key||"Backspace"===e.key&&this.selectedText?this.closeContextMenu():void 0}_onSelectionChanged(){this.positionContextMenu(),this.showContextMenu=!0}generateGetBoundingClientRect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0
return()=>({width:e,height:t,top:o,right:i,bottom:o,left:i})}get canCloseContextMenu(){return document.activeElement!==this._customPromptInput&&((!this.loading||null===this._activeAIRequest)&&this.menuState!==this.CONTEXT_MENU_STATES.review)}closeContextMenu(){this.canCloseContextMenu&&(this.showContextMenu=!1,this.menuState=this.CONTEXT_MENU_STATES.triggers,this.customPromptValue="")}_updateSuggestedByAI(e){this.newSelectedText=e.suggestions[0],e.diff&&(this.diff=e.diff),this._insertAt(this.selectionRange.x,this.selectionRange.y,this.newSelectedText),this.menuState=this.CONTEXT_MENU_STATES.review}_insertAt(e,t,i){this._dEditorInput.setSelectionRange(e,t),this._dEditorInput.focus(),document.execCommand("insertText",!1,i)}_toggleLoadingState(e){return e?(this._dEditorInput.classList.add("loading"),this.loading=!0):(this._dEditorInput.classList.remove("loading"),this.loading=!1)}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}handleBoundaries(){const e=document.querySelector(".d-editor-textarea-wrapper").getBoundingClientRect(),t=document.querySelector(".d-editor-button-bar").getBoundingClientRect().bottom,i=e.bottom,o=this._contextMenu.getBoundingClientRect()
o.top<t||o.bottom>i?this._contextMenu.classList.add("out-of-bounds"):this._contextMenu.classList.remove("out-of-bounds"),this.caretCoords.y-o.height<t?this.popperPlacement="bottom-start":this.popperPlacement="top-start"}positionContextMenu(){this._contextMenu=document.querySelector(".ai-helper-context-menu"),this.caretCoords=(0,l.getCaretPosition)(this._dEditorInput,{pos:(0,l.caretPosition)(this._dEditorInput)}),this.handleBoundaries(),this.virtualElement={getBoundingClientRect:this.generateGetBoundingClientRect(this._contextMenu.clientWidth,this._contextMenu.clientHeight,this.caretCoords.x,this.caretCoords.y)},this._popper=(0,r.createPopper)(this.virtualElement,this._contextMenu,{placement:this.popperPlacement,modifiers:[{name:"offset",options:{offset:[10,0]}}]})}setupContextMenu(){document.addEventListener("selectionchange",this.selectionChanged),document.addEventListener("keydown",this.onKeyDown),this._dEditorInput=document.querySelector(".d-editor-input"),this._dEditorInput&&this._dEditorInput.addEventListener("scroll",this.updatePosition)}setupCustomPrompt(){this._customPromptInput=document.querySelector(".ai-custom-prompt__input"),this._customPromptInput.focus()}toggleAiHelperOptions(){this.menuState=this.CONTEXT_MENU_STATES.options}undoAIAction(){this.capabilities.isFirefox?this._insertAt(this.lastSelectionRange.x,this.lastSelectionRange.y,this.initialValue):document.execCommand("undo",!1,null),this.menuState=this.CONTEXT_MENU_STATES.resets,this.closeContextMenu()}async updateSelected(e){return this._toggleLoadingState(!0),this.lastUsedOption=e,this.menuState=this.CONTEXT_MENU_STATES.loading,this.initialValue=this.selectedText,this.lastSelectionRange=this.selectionRange,this._activeAIRequest=(0,n.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.id,text:this.selectedText,custom_prompt:this.customPromptValue}}),this._activeAIRequest.then((t=>{this.diff=null,this.newSelectedText=null,this.thumbnailSuggestions=null,"illustrate_post"===e.name?(this._toggleLoadingState(!1),this.closeContextMenu(),this.showThumbnailModal=!0,this.thumbnailSuggestions=t.thumbnails):this._updateSuggestedByAI(t)})).catch(a.popupAjaxError).finally((()=>{this._toggleLoadingState(!1)})),this._activeAIRequest}viewChanges(){this.showDiffModal=!0}confirmChanges(){this.menuState=this.CONTEXT_MENU_STATES.resets}cancelAIAction(){this._activeAIRequest&&(this._activeAIRequest.abort(),this._activeAIRequest=null,this._toggleLoadingState(!1),this.closeContextMenu())}togglePreviousMenu(){this.menuState=this.previousMenuState}},g=G(m.prototype,"currentUser",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=G(m.prototype,"siteSettings",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=G(m.prototype,"modal",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=G(m.prototype,"capabilities",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=G(m.prototype,"showContextMenu",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=G(m.prototype,"caretCoords",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=G(m.prototype,"virtualElement",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=G(m.prototype,"selectedText",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),S=G(m.prototype,"newSelectedText",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=G(m.prototype,"loading",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j=G(m.prototype,"lastUsedOption",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=G(m.prototype,"showDiffModal",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),x=G(m.prototype,"showThumbnailModal",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z=G(m.prototype,"diff",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=G(m.prototype,"popperPlacement",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"top-start"}}),M=G(m.prototype,"previousMenuState",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=G(m.prototype,"customPromptValue",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),A=G(m.prototype,"initialValue",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),E=G(m.prototype,"thumbnailSuggestions",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=G(m.prototype,"selectionRange",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{x:0,y:0}}}),I=G(m.prototype,"lastSelectionRange",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=G(m.prototype,"_menuState",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.CONTEXT_MENU_STATES.triggers}}),R=G(m.prototype,"_popper",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=G(m.prototype,"_dEditorInput",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=G(m.prototype,"_customPromptInput",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=G(m.prototype,"_contextMenu",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=G(m.prototype,"_activeAIRequest",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G(m.prototype,"selectionChanged",[c.bind],Object.getOwnPropertyDescriptor(m.prototype,"selectionChanged"),m.prototype),G(m.prototype,"updatePosition",[c.bind],Object.getOwnPropertyDescriptor(m.prototype,"updatePosition"),m.prototype),G(m.prototype,"onKeyDown",[c.bind],Object.getOwnPropertyDescriptor(m.prototype,"onKeyDown"),m.prototype),G(m.prototype,"_onSelectionChanged",[p],Object.getOwnPropertyDescriptor(m.prototype,"_onSelectionChanged"),m.prototype),G(m.prototype,"positionContextMenu",[c.afterRender],Object.getOwnPropertyDescriptor(m.prototype,"positionContextMenu"),m.prototype),G(m.prototype,"setupContextMenu",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"setupContextMenu"),m.prototype),G(m.prototype,"setupCustomPrompt",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"setupCustomPrompt"),m.prototype),G(m.prototype,"toggleAiHelperOptions",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"toggleAiHelperOptions"),m.prototype),G(m.prototype,"undoAIAction",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"undoAIAction"),m.prototype),G(m.prototype,"updateSelected",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"updateSelected"),m.prototype),G(m.prototype,"viewChanges",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"viewChanges"),m.prototype),G(m.prototype,"confirmChanges",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"confirmChanges"),m.prototype),G(m.prototype,"cancelAIAction",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"cancelAIAction"),m.prototype),G(m.prototype,"togglePreviousMenu",[o.action],Object.getOwnPropertyDescriptor(m.prototype,"togglePreviousMenu"),m.prototype),m)})),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse-i18n"],(function(e,t,i,o,s){"use strict"
var r,n,a,l,u
function c(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function d(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=(0,i.computed)("composerModel.targetRecipients","composerModel.title"),n=(0,i.computed)("composerModel.targetRecipients"),a=class extends t.default{constructor(){super(...arguments),c(this,"currentUser",l,this),c(this,"siteSettings",u,this)}get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===s.default.t("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.any((t=>e.any((e=>e===t.username))))}return!1}},l=d(a.prototype,"currentUser",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=d(a.prototype,"siteSettings",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d(a.prototype,"aiBotClasses",[r],Object.getOwnPropertyDescriptor(a.prototype,"aiBotClasses"),a.prototype),d(a.prototype,"isAiBotChat",[n],Object.getOwnPropertyDescriptor(a.prototype,"isAiBotChat"),a.prototype),a)})),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","@ember/template-factory","@ember/component","@ember/component/template-only"],(function(e,t,i,o,s,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,s.setComponentTemplate)((0,o.createTemplateFactory)({id:"+zzrKPCx",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n    "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[i.default,t.default],isStrictMode:!0}),(0,r.default)())
e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-selector",["exports","@glimmer/component","@ember/helper","@ember/service","discourse/lib/key-value-store","select-kit/components/dropdown-select-box","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a){"use strict"
var l,u,c
function d(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(c=class extends t.default{static shouldRender(e,t){return t?.currentUser?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const i=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.any((e=>i.any((t=>t===e.username))))}return!1}(e.model,t.currentUser)}constructor(){var e,t,i,o
if(super(...arguments),e=this,t="currentUser",o=this,(i=u)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0}),d(this,"STORE_NAMESPACE","discourse_ai_persona_selector_"),d(this,"preferredPersonaStore",new s.default(this.STORE_NAMESPACE)),this.botOptions&&this.composer){let e=this.preferredPersonaStore.getObject("id")
this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.any((t=>t.id===e))&&(this._value=e)),this.composer.metaData={ai_persona_id:this._value}}}get composer(){return this.args?.outletArgs?.model}get botOptions(){if(this.currentUser.ai_enabled_personas)return this.currentUser.ai_enabled_personas.map((e=>({id:e.id,name:e.name,description:e.description})))}get filterable(){return this.botOptions.length>4}get value(){return this._value}set value(e){this._value=e,this.preferredPersonaStore.setObject({key:"id",value:e}),this.composer.metaData={ai_persona_id:e}}},(0,a.setComponentTemplate)((0,n.createTemplateFactory)({id:"TcbpLBxH",block:'[[[1,"\\n    "],[10,0],[14,0,"gpt-persona"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"persona-selector__dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,1],null,[["icon","filterable"],["robot",[30,0,["filterable"]]]]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-selector.js",scope:()=>[r.default,i.hash],isStrictMode:!0}),c),p=(l=c).prototype,m="currentUser",g=[o.inject],b={configurable:!0,enumerable:!0,writable:!0,initializer:null},f={},Object.keys(b).forEach((function(e){f[e]=b[e]})),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=g.slice().reverse().reduce((function(e,t){return t(p,m,e)||e}),f),h&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(h):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(p,m,f),f=null),u=f,l)
var p,m,g,b,h,f}))
define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/modifiers/auto-focus","discourse-common/helpers/d-icon","discourse-common/helpers/i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m,g,b,h){"use strict"
var f,y,_,v,w
function S(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function P(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(w=class extends t.default{constructor(){super(...arguments),S(this,"imageCaptionPopup",y,this),S(this,"appEvents",_,this),S(this,"composer",v,this)}updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}saveCaption(){const e=this.imageCaptionPopup.imageIndex,t=this.composer.model.reply.match(g.IMAGE_MARKDOWN_REGEX)
if(t){const i=t[e],o=i.replace(g.IMAGE_MARKDOWN_REGEX,`![${this.imageCaptionPopup.newCaption}|$2$3$4]($5)`)
i&&this.appEvents.trigger("composer:replace-text",i,o)}this.hidePopup()}resizeTextarea(e){const t=window.getComputedStyle(e),i=parseInt(t.borderTopWidth,10),o=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+i+o}px`}hidePopup(){this.imageCaptionPopup.showPopup=!1}},(0,h.setComponentTemplate)((0,b.createTemplateFactory)({id:"8IZQ15+0",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"      "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n        "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[10,0],[14,0,"actions"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n          "],[8,[32,7],[[24,0,"btn-flat"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n          "],[10,1],[14,0,"credits"],[12],[1,"\\n            "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n            "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[n.default,l.default,c.default,s.default,r.default,i.on,d.default,u.default,p.default,m.default],isStrictMode:!0}),w),y=P((f=w).prototype,"imageCaptionPopup",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=P(f.prototype,"appEvents",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=P(f.prototype,"composer",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P(f.prototype,"updateCaption",[o.action],Object.getOwnPropertyDescriptor(f.prototype,"updateCaption"),f.prototype),P(f.prototype,"saveCaption",[o.action],Object.getOwnPropertyDescriptor(f.prototype,"saveCaption"),f.prototype),P(f.prototype,"resizeTextarea",[o.action],Object.getOwnPropertyDescriptor(f.prototype,"resizeTextarea"),f.prototype),P(f.prototype,"hidePopup",[o.action],Object.getOwnPropertyDescriptor(f.prototype,"hidePopup"),f.prototype),f)})),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c){"use strict"
var d,p,m,g,b,h
function f(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function y(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(h=class extends t.default{constructor(){super(...arguments),f(this,"currentUser",p,this),f(this,"loading",m,this),f(this,"suggestion",g,this),f(this,"_activeAIRequest",b,this)}static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find((e=>"proofread"===e.name))}suggest(){return this.loading=!0,this._activeAIRequest=(0,n.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.id,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then((e=>{let{suggestions:t}=e
this.suggestion=t[0].trim(),this.args.outletArgs.updateValue(this.suggestion)})).catch(a.popupAjaxError).finally((()=>{this.loading=!1})),this._activeAIRequest}},(0,c.setComponentTemplate)((0,u.createTemplateFactory)({id:"9jHc25oQ",block:'[[[1,"\\n"],[41,[51,[30,1,["newValue"]]],[[[1,"      "],[8,[32,0],[[24,0,"btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[r.default],isStrictMode:!0}),h),p=y((d=h).prototype,"currentUser",[s.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=y(d.prototype,"loading",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),g=y(d.prototype,"suggestion",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),b=y(d.prototype,"_activeAIRequest",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y(d.prototype,"suggest",[o.action],Object.getOwnPropertyDescriptor(d.prototype,"suggest"),d.prototype),d)})),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/lib/ajax","discourse/lib/plugin-api","discourse/lib/search","discourse-common/helpers/d-icon","I18n","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m,g,b){"use strict"
var h,f,y,_,v,w,S,P,j
function O(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function x(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function z(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(j=class extends t.default{constructor(){super(...arguments),O(this,"appEvents",f,this),O(this,"siteSettings",y,this),O(this,"searchPreferencesManager",_,this),O(this,"searching",v,this),O(this,"AIResults",w,this),O(this,"showingAIResults",S,this),O(this,"preventAISearch",P,this),x(this,"initialSearchTerm",this.args.outletArgs.search)}static shouldRender(e,t){let{siteSettings:i}=t
return i.ai_embeddings_semantic_search_enabled}get disableToggleSwitch(){if(this.searching||0===this.AIResults.length||this.preventAISearch)return!0}get searchStateText(){return this.AIResults.length>0?this.showingAIResults?m.default.t("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AIResults.length}):m.default.t("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AIResults.length}):this.preventAISearch?m.default.t("discourse_ai.embeddings.semantic_search_disabled_sort"):this.searching?m.default.t("discourse_ai.embeddings.semantic_search_loading"):0===this.AIResults.length&&this.searchTerm!==this.initialSearchTerm?m.default.t("discourse_ai.embeddings.semantic_search_results.new"):0===this.AIResults.length?m.default.t("discourse_ai.embeddings.semantic_search_results.none"):void 0}get searchTerm(){return this.initialSearchTerm!==this.args.outletArgs.search&&(this.initialSearchTerm=void 0),this.args.outletArgs.search}get searchEnabled(){return this.args.outletArgs.type===l.SEARCH_TYPE_DEFAULT&&(0,d.isValidSearchTerm)(this.searchTerm,this.siteSettings)}toggleAIResults(){this.showingAIResults?this.args.outletArgs.addSearchResults([],"topic_id"):this.args.outletArgs.addSearchResults(this.AIResults,"topic_id"),this.showingAIResults=!this.showingAIResults}resetAIResults(){this.AIResults=[],this.showingAIResults=!1,this.args.outletArgs.addSearchResults([],"topic_id")}handleSearch(){if(this.searchEnabled)if(void 0===this.searchPreferencesManager?.sortOrder||0===this.searchPreferencesManager?.sortOrder){if(this.preventAISearch=!1,this.initialSearchTerm&&!this.searching)return this.performHyDESearch();(0,c.withPluginApi)("1.15.0",(e=>{e.onAppEvent("full-page-search:trigger-search",(()=>{if(!this.searching)return this.resetAIResults(),this.performHyDESearch()}))}))}else this.preventAISearch=!0}performHyDESearch(){this.searching=!0,this.resetAIResults(),(0,u.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then((async e=>{const t=await(0,d.translateResults)(e)||{}
0!==t.posts?.length?(t.posts.forEach((e=>{e.generatedByAI=!0})),this.AIResults=t.posts):this.searching=!1})).finally((()=>this.searching=!1))}},(0,b.setComponentTemplate)((0,g.createTemplateFactory)({id:"3cSLRgPA",block:'[[[1,"\\n"],[41,[30,0,["searchEnabled"]],[[[1,"      "],[10,0],[14,0,"semantic-search__container search-results"],[14,"role","region"],[12],[1,"\\n        "],[11,0],[24,0,"semantic-search__results"],[4,[32,0],[[30,0,["handleSearch"]]],null],[12],[1,"\\n          "],[10,0],[15,0,[29,["semantic-search__searching\\n              ",[52,[30,0,["searching"]],"in-progress"]]]],[12],[1,"\\n            "],[8,[32,1],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,"title","AI search results hidden"],[24,0,"semantic-search__results-toggle"],[4,[32,2],["click",[30,0,["toggleAIResults"]]],null]],[["@state"],[[30,0,["showingAIResults"]]]],null],[1,"\\n\\n            "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n              "],[1,[28,[32,3],["discourse-sparkles"],null]],[1,"\\n              "],[1,[30,0,["searchStateText"]]],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,0,["searching"]],[[[1,"              "],[10,1],[14,0,"semantic-search__indicator-wave"],[12],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n                "],[10,1],[14,0,"semantic-search__indicator-dot"],[12],[1,"."],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/semantic-search.js",scope:()=>[r.default,a.default,o.on,p.default],isStrictMode:!0}),j),f=z((h=j).prototype,"appEvents",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=z(h.prototype,"siteSettings",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=z(h.prototype,"searchPreferencesManager",[n.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=z(h.prototype,"searching",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w=z(h.prototype,"AIResults",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),S=z(h.prototype,"showingAIResults",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),P=z(h.prototype,"preventAISearch",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z(h.prototype,"toggleAIResults",[s.action],Object.getOwnPropertyDescriptor(h.prototype,"toggleAIResults"),h.prototype),z(h.prototype,"resetAIResults",[s.action],Object.getOwnPropertyDescriptor(h.prototype,"resetAIResults"),h.prototype),z(h.prototype,"handleSearch",[s.action],Object.getOwnPropertyDescriptor(h.prototype,"handleSearch"),h.prototype),h)})),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-helper-options-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/utilities","discourse-common/utils/decorators","truth-helpers/helpers/eq","truth-helpers/helpers/not","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n,a,l,u,c,d,p,m,g,b,h,f,y,_,v,w,S){"use strict"
var P,j,O,x,z,T,M,k,A,E,C,I,N,R,D,L,B,U
function q(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function F(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function G(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(U=class extends t.default{constructor(){super(...arguments),q(this,"messageBus",j,this),q(this,"site",O,this),q(this,"modal",x,this),q(this,"siteSettings",z,this),q(this,"currentUser",T,this),q(this,"menu",M,this),q(this,"menuState",k,this),q(this,"loading",A,this),q(this,"suggestion",E,this),q(this,"showMainButtons",C,this),q(this,"customPromptValue",I,this),q(this,"copyButtonIcon",N,this),q(this,"copyButtonLabel",R,this),q(this,"showFastEdit",D,this),q(this,"showAiButtons",L,this),F(this,"MENU_STATES",{triggers:"TRIGGERS",options:"OPTIONS",loading:"LOADING",result:"RESULT"}),q(this,"_activeAIRequest",B,this)}static shouldRender(e,t){return(0,v.showPostAIHelper)(e,t)}async showAIHelperOptions(){this.showMainButtons=!1,this.menuState=this.MENU_STATES.options,this.menu.activeMenu.options.placement="bottom"}subscribe(){const e=`/discourse-ai/ai-helper/explain/${this.args.outletArgs.data.quoteState.postId}`
this.messageBus.subscribe(e,this._updateResult)}unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-helper/explain/*",this._updateResult)}_updateResult(e){this.suggestion=e.result}async performAISuggestion(e){if(this.menuState=this.MENU_STATES.loading,"explain"===e.name){this.menuState=this.MENU_STATES.result
const t="/discourse-ai/ai-helper/explain"
this._activeAIRequest=(0,p.ajax)(t,{method:"POST",data:{mode:e.value,text:this.args.outletArgs.data.quoteState.buffer,post_id:this.args.outletArgs.data.quoteState.postId}})}else this._activeAIRequest=(0,p.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.id,text:this.args.outletArgs.data.quoteState.buffer,custom_prompt:this.customPromptValue}})
return"explain"!==e.name&&this._activeAIRequest.then((t=>{let{suggestions:i}=t
if(this.suggestion=i[0].trim(),"proofread"===e.name)return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(d.default,{model:{initialValue:this.args.outletArgs.data.quoteState.buffer,newValue:this.suggestion,post:this.args.outletArgs.post,close:this.closeFastEdit}})})).catch(m.popupAjaxError).finally((()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})),this._activeAIRequest}cancelAIAction(){this._activeAIRequest&&(this._activeAIRequest.abort(),this._activeAIRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}copySuggestion(){this.suggestion?.length>0&&((0,g.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout((()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"}),3500))}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("post")))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const i=e.splice(t,1)[0]
e.unshift(i)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),this.args.outletArgs.data.canEditPost||(e=e.filter((e=>"proofread"!==e.name))),e}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}async closeFastEdit(){this.showFastEdit=!1,await this.args.outletArgs.data.hideToolbar()}},(0,S.setComponentTemplate)((0,w.createTemplateFactory)({id:"j9occbDk",block:'[[[1,"\\n"],[41,[30,0,["showMainButtons"]],[[[1,"      "],[18,3,null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","triggers"]]],null],[[[1,"          "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAIHelperOptions"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[10,0],[14,0,"ai-post-helper__options"],[12],[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["helperOptions"]]],null]],null],null,[[[41,[28,[32,0],[[30,1,["name"]],"custom_prompt"],null],[[[1,"                "],[8,[32,2],null,[["@value","@promptArgs","@submit"],[[30,0,["customPromptValue"]],[30,1],[30,0,["performAISuggestion"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[8,[32,1],[[16,"data-name",[30,1,["name"]]],[16,"data-value",[30,1,["id"]]],[24,0,"btn-flat ai-post-helper__options-button"]],[["@icon","@translatedLabel","@action"],[[30,1,["icon"]],[30,1,["translated_name"]],[28,[32,3],[[30,0,["performAISuggestion"]],[30,1]],null]]],null],[1,"\\n"]],[]]]],[1]],null],[1,"          "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"          "],[8,[32,4],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"          "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,5],[[30,0,["subscribe"]]],null],[4,[32,6],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"              "],[10,0],[14,0,"ai-post-helper__suggestion__text"],[14,"dir","auto"],[12],[1,"\\n                "],[8,[32,7],null,[["@rawText"],[[30,0,["suggestion"]]]],null],[1,"\\n              "],[13],[1,"\\n              "],[10,"di"],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n                "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["times","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAIAction"]]]],null],[1,"\\n                "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[28,[32,8],[[30,0,["suggestion"]]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[8,[32,4],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "]],[]],null]],[]]]],[]]]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n        "],[8,[32,9],null,[["@initialValue","@newValue","@post","@close"],[[30,2,["data","quoteState","buffer"]],[30,0,["suggestion"]],[30,2,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["option","@outletArgs","&default"],false,["if","yield","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-helper-options-menu.js",scope:()=>[h.default,u.default,y.default,o.fn,_.default,r.default,n.default,l.default,f.default,c.default],isStrictMode:!0}),U),j=G((P=U).prototype,"messageBus",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=G(P.prototype,"site",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=G(P.prototype,"modal",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=G(P.prototype,"siteSettings",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=G(P.prototype,"currentUser",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=G(P.prototype,"menu",[a.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=G(P.prototype,"menuState",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.MENU_STATES.triggers}}),A=G(P.prototype,"loading",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),E=G(P.prototype,"suggestion",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C=G(P.prototype,"showMainButtons",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),I=G(P.prototype,"customPromptValue",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),N=G(P.prototype,"copyButtonIcon",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"copy"}}),R=G(P.prototype,"copyButtonLabel",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"discourse_ai.ai_helper.post_options_menu.copy"}}),D=G(P.prototype,"showFastEdit",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L=G(P.prototype,"showAiButtons",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),B=G(P.prototype,"_activeAIRequest",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G(P.prototype,"showAIHelperOptions",[s.action],Object.getOwnPropertyDescriptor(P.prototype,"showAIHelperOptions"),P.prototype),G(P.prototype,"subscribe",[b.bind],Object.getOwnPropertyDescriptor(P.prototype,"subscribe"),P.prototype),G(P.prototype,"unsubscribe",[b.bind],Object.getOwnPropertyDescriptor(P.prototype,"unsubscribe"),P.prototype),G(P.prototype,"_updateResult",[b.bind],Object.getOwnPropertyDescriptor(P.prototype,"_updateResult"),P.prototype),G(P.prototype,"performAISuggestion",[s.action],Object.getOwnPropertyDescriptor(P.prototype,"performAISuggestion"),P.prototype),G(P.prototype,"cancelAIAction",[s.action],Object.getOwnPropertyDescriptor(P.prototype,"cancelAIAction"),P.prototype),G(P.prototype,"copySuggestion",[s.action],Object.getOwnPropertyDescriptor(P.prototype,"copySuggestion"),P.prototype),G(P.prototype,"closeFastEdit",[s.action],Object.getOwnPropertyDescriptor(P.prototype,"closeFastEdit"),P.prototype),P)})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n){"use strict"
var a,l,u
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(u=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="siteSettings",o=this,(i=l)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}static shouldRender(e,t){return(0,s.showPostAIHelper)(e,t)}},(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"4O7HJkah",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[o.default],isStrictMode:!0}),u),c=(a=u).prototype,d="siteSettings",p=[i.inject],m={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(m).forEach((function(e){b[e]=m[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,d,e)||e}),b),g&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(g):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,d,b),b=null),l=b,a)
var c,d,p,m,g,b})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r,n){"use strict"
var a,l,u
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(u=class extends t.default{constructor(){var e,t,i,o
super(...arguments),e=this,t="siteSettings",o=this,(i=l)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}static shouldRender(e,t){return(0,s.showPostAIHelper)(e,t)}},(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"jo6+zYZR",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[o.default],isStrictMode:!0}),u),c=(a=u).prototype,d="siteSettings",p=[i.inject],m={configurable:!0,enumerable:!0,writable:!0,initializer:null},b={},Object.keys(m).forEach((function(e){b[e]=m[e]})),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=p.slice().reverse().reduce((function(e,t){return t(c,d,e)||e}),b),g&&void 0!==b.initializer&&(b.value=b.initializer?b.initializer.call(g):void 0,b.initializer=void 0),void 0===b.initializer&&(Object.defineProperty(c,d,b),b=null),l=b,a)
var c,d,p,m,g,b})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/template-factory","@ember/component"],(function(e,t,i,o,s,r){"use strict"
var n
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}}e.default=a,n=a,(0,r.setComponentTemplate)((0,s.createTemplateFactory)({id:"obhR2Q8M",block:'[[[1,"\\n    "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),n)})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-more-content/related-topics",["exports","@glimmer/component","@ember/object","@ember/service","I18n"],(function(e,t,i,o,s){"use strict"
var r,n,a,l,u
function c(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function d(e,t,i){var o
return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e
var i=e[Symbol.toPrimitive]
if(void 0!==i){var o=i.call(e,t||"default")
if("object"!=typeof o)return o
throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:String(o))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function p(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(r=(0,i.computed)("moreTopicsPreferenceTracking.selectedTab"),n=class extends t.default{constructor(){super(...arguments),c(this,"store",a,this),c(this,"site",l,this),c(this,"moreTopicsPreferenceTracking",u,this),d(this,"listId","related-topics")}static shouldRender(e){return(e.model.related_topics?.length||0)>0}get hidden(){return this.moreTopicsPreferenceTracking.selectedTab!==this.listId}get relatedTopics(){return this.args.outletArgs.model.related_topics.map((e=>this.store.createRecord("topic",e)))}registerList(){this.moreTopicsPreferenceTracking.registerTopicList({name:s.default.t("discourse_ai.related_topics.pill"),id:this.listId,icon:"discourse-sparkles"})}removeList(){this.moreTopicsPreferenceTracking.removeTopicList(this.listId)}},a=p(n.prototype,"store",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=p(n.prototype,"site",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=p(n.prototype,"moreTopicsPreferenceTracking",[o.inject],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p(n.prototype,"hidden",[r],Object.getOwnPropertyDescriptor(n.prototype,"hidden"),n.prototype),p(n.prototype,"registerList",[i.action],Object.getOwnPropertyDescriptor(n.prototype,"registerList"),n.prototype),p(n.prototype,"removeList",[i.action],Object.getOwnPropertyDescriptor(n.prototype,"removeList"),n.prototype),n)})),define("discourse/plugins/discourse-ai/discourse/controllers/admin-dashboard-sentiment",["exports","@ember/object","admin/controllers/admin-dashboard-tab"],(function(e,t,i){"use strict"
var o,s
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(o=(0,t.computed)("startDate","endDate"),s=class extends i.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}},r=s.prototype,n="filters",a=[o],l=Object.getOwnPropertyDescriptor(s.prototype,"filters"),u=s.prototype,c={},Object.keys(l).forEach((function(e){c[e]=l[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=a.slice().reverse().reduce((function(e,t){return t(r,n,e)||e}),c),u&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(u):void 0,c.initializer=void 0),void 0===c.initializer&&(Object.defineProperty(r,n,c),c=null),s)
var r,n,a,l,u,c})),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/models/composer","I18n"],(function(e,t,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.composeAiBotMessage=function(e,o){let s=o.currentUser.ai_enabled_chat_bots.find((t=>t.model_name===e)).username
o.focusComposer({fallbackToNewTopic:!0,openOpts:{action:t.default.PRIVATE_MESSAGE,recipients:s,topicTitle:i.default.t("discourse_ai.ai_bot.default_pm_prefix"),archetypeId:"private_message",draftKey:"private_message_ai",hasGroups:!1,warningsDisabled:!0,skipDraftCheck:!0}})}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer",["exports","@ember/runloop","discourse/lib/load-script","discourse/lib/text"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDot=c,e.applyProgress=m,e.default=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,g(e)}
const s=40,r=6e4,n=e.MIN_LETTERS_PER_INTERVAL=6,a=800
let l=null
function u(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}function c(e){let t=e
for(;;){let e=u(t)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
t=e}const i=document.createElement("span")
i.classList.add("progress-dot"),t.appendChild(i)}class d{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}class p extends d{constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t),this.post&&(this.postElement=document.querySelector(`#post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const i=await(0,o.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const s=document.createElement("div")
s.innerHTML=i,t||c(s),await this.setCooked(s.innerHTML)}async setCooked(e){this.post.set("cooked",e)
const t=this.postElement.querySelector(".cooked")
await(0,i.default)("/javascripts/diffhtml.min.js"),window.diff.innerHTML(t,e)}get raw(){return this.post.get("raw")||""}}async function m(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>r)return t.streaming=!1,!0
if(!t.element)return!1
const i=t.raw
if(e.raw===i&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let o=e.raw
if(!e.done)if(0===i.length&&-1!==o.indexOf("</details>"))o=e.raw
else{const t=o.length-i.length
let r=Math.floor(t/(a/s))
r<n&&(r=n),o=e.raw.substring(0,i.length+r)}await t.setRaw(o,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked),t.streaming=!1),e.done}function g(e){l||(l=(0,t.later)((async()=>{const t=await async function(e){const t=e.aiStreamingStatus
let i=!1
const o=Object.keys(t).map((async o=>{let s=t[o]
const r=new p(e,s.post_id)
await m(s,r)?delete t[o]:i=!0}))
return await Promise.all(o),i}(e)
l=null,t&&g(e)}),s))}})),define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],(function(e,t,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,s,r){await(0,i.clipboardCopyAsync)((async()=>{const i=await async function(e,i,s){const r=e.get("postStream")
let n=[]
for(let t=i;t<=s;t++)n.push(t)
const a=n.map((e=>r.findPostIdForPostNumber(e))),l=`/t/${e.id}/posts.json`,u={post_ids:a,include_raw:!0},c=await(0,t.ajax)(l,{data:u})
let d=[]
d.push("<details class='ai-quote'>"),d.push("<summary>"),d.push(`<span>${e.title}</span>`),d.push(`<span title='${o.default.t("discourse_ai.ai_bot.ai_title")}'>${o.default.t("discourse_ai.ai_bot.ai_label")}</span>`),d.push("</summary>"),c.post_stream.posts.forEach((e=>{d.push(""),d.push(`**${e.username}:**`),d.push(""),d.push(e.raw)})),d.push("</details>")
const p=d.join("\n")
return p}(e,s,r)
return new Blob([i],{type:"text/plain"})}))}})),define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],(function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.composer_ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAIHelper=function(e,i,o){const s=t(i.siteSettings),r=i.currentUser.can_use_assistant,n=i.siteSettings.ai_helper_allowed_in_pm,a=i.siteSettings.ai_helper_enabled_features.includes(o)
if(e?.composer?.privateMessage)return s&&r&&n&&a
return s&&r&&a},e.showPostAIHelper=function(e,i){return t(i.siteSettings)&&i.currentUser.can_use_assistant_in_post}})),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.IMAGE_MARKDOWN_REGEX=void 0
e.IMAGE_MARKDOWN_REGEX=/!\[(.*?)\|(\d{1,4}x\d{1,4})(,\s*\d{1,3}%)?(.*?)\]\((upload:\/\/.*?)\)(?!(.*`))/g})),define("discourse/plugins/discourse-ai/discourse/routes/admin-plugins-discourse-ai-ai-personas-index",["exports","discourse/routes/discourse"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=t.default.extend({model(){return this.modelFor("adminPlugins.discourse-ai.ai-personas")}})})),define("discourse/plugins/discourse-ai/discourse/routes/admin-plugins-discourse-ai-ai-personas-new",["exports","discourse/routes/discourse"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=t.default.extend({async model(){const e=this.store.createRecord("ai-persona")
return e.set("allowed_group_ids",[10]),e},setupController(e,t){this._super(e,t),e.set("allPersonas",this.modelFor("adminPlugins.discourse-ai.ai-personas"))}})})),define("discourse/plugins/discourse-ai/discourse/routes/admin-plugins-discourse-ai-ai-personas-show",["exports","discourse/routes/discourse"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=t.default.extend({async model(e){const t=this.modelFor("adminPlugins.discourse-ai.ai-personas"),i=parseInt(e.id,10)
return t.findBy("id",i)},setupController(e,t){this._super(e,t),e.set("allPersonas",this.modelFor("adminPlugins.discourse-ai.ai-personas"))}})})),define("discourse/plugins/discourse-ai/discourse/routes/admin-plugins-discourse-ai-ai-personas",["exports","discourse/routes/discourse"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=t.default.extend({async model(){return this.store.findAll("ai-persona")}})})),define("discourse/plugins/discourse-ai/discourse/routes/admin-plugins-discourse-ai-index",["exports","@ember/service","discourse/routes/discourse"],(function(e,t,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=i.default.extend({router:(0,t.inject)(),beforeModel(){this.router.transitionTo("adminPlugins.discourse-ai.ai-personas")}})})),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service"],(function(e,t,i){"use strict"
var o,s,r,n,a,l
function u(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function c(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(o=class extends i.default{constructor(){super(...arguments),u(this,"showPopup",s,this),u(this,"imageIndex",r,this),u(this,"imageSrc",n,this),u(this,"newCaption",a,this),u(this,"loading",l,this)}},s=c(o.prototype,"showPopup",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),r=c(o.prototype,"imageIndex",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),n=c(o.prototype,"imageSrc",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=c(o.prototype,"newCaption",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=c(o.prototype,"loading",[t.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o)})),define("discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"nGq01/Xy",block:'[[[10,0],[14,0,"sentiment section"],[12],[1,"\\n  "],[10,0],[14,0,"period-section"],[12],[1,"\\n    "],[10,0],[14,0,"section-title"],[12],[1,"\\n      "],[10,"h2"],[12],[1,"\\n        "],[1,[28,[35,0],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[39,1],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,0,["period"]],[30,0,["setPeriod"]],[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["setCustomDateRange"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"section-body"],[12],[1,"\\n    "],[10,0],[14,0,"charts"],[12],[1,"\\n      "],[8,[39,2],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,0,["filters"]],true]],null],[1,"\\n\\n      "],[8,[39,2],null,[["@dataSourceName","@filters","@showHeader"],["post_emotion",[30,0,["filters"]],true]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],[],false,["i18n","dashboard-period-selector","admin-report"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/index",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"+08OpQF9",block:'[[[8,[39,0],null,[["@personas"],[[30,0,["model"]]]],null]],[],false,["ai-persona-list-editor"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/index.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/new",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"4OQ50K5K",block:'[[[8,[39,0],null,[["@personas","@currentPersona"],[[30,0,["allPersonas"]],[30,0,["model"]]]],null]],[],false,["ai-persona-list-editor"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/new.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/show",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"4Vqg1JJH",block:'[[[8,[39,0],null,[["@personas","@currentPersona"],[[30,0,["allPersonas"]],[30,0,["model"]]]],null]],[],false,["ai-persona-list-editor"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-plugins/discourse-ai/ai-personas/show.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/ai-helper-context-menu",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"9lPQdG4P",block:'[[[11,0],[4,[38,0],[[30,0,["setupContextMenu"]]],null],[12],[1,"\\n"],[41,[30,0,["showContextMenu"]],[[[1,"    "],[10,0],[14,0,"ai-helper-context-menu"],[12],[1,"\\n"],[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","triggers"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__trigger"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@action","@label"],["discourse-sparkles",[30,0,["toggleAiHelperOptions"]],"discourse_ai.ai_helper.context_menu.trigger"]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","options"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__options"],[12],[1,"\\n"],[42,[28,[37,5],[[28,[37,5],[[30,0,["helperOptions"]]],null]],null],null,[[[41,[28,[37,2],[[30,1,["name"]],"custom_prompt"],null],[[[1,"              "],[8,[39,6],null,[["@value","@promptArgs","@submit"],[[30,0,["customPromptValue"]],[30,1],[30,0,["updateSelected"]]]],null],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,1,["translated_name"]]],[15,"data-value",[30,1,["id"]]],[12],[1,"\\n                "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@translatedLabel","@action"],[[30,1,["icon"]],[30,1,["translated_name"]],[28,[37,7],[[30,0,["updateSelected"]],[30,1]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]]],[1]],null],[1,"        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","loading"]]],null],[[[1,"        "],[8,[39,8],null,[["@cancel"],[[30,0,["cancelAIAction"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","review"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__review"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat view-changes"]],[["@icon","@label","@action"],["exchange-alt","discourse_ai.ai_helper.context_menu.view_changes",[30,0,["viewChanges"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat revert"]],[["@icon","@label","@action"],["undo","discourse_ai.ai_helper.context_menu.revert",[30,0,["undoAIAction"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat confirm"]],[["@icon","@label","@action"],["check","discourse_ai.ai_helper.context_menu.confirm",[30,0,["confirmChanges"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n\\n"]],[]],[[[41,[28,[37,2],[[30,0,["menuState"]],[30,0,["CONTEXT_MENU_STATES","resets"]]],null],[[[1,"        "],[10,"ul"],[14,0,"ai-helper-context-menu__resets"],[12],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat undo"]],[["@icon","@label","@action"],["undo","discourse_ai.ai_helper.context_menu.undo",[30,0,["undoAIAction"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,"li"],[12],[1,"\\n            "],[8,[39,3],[[24,0,"btn-flat"]],[["@icon","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.context_menu.regen",[28,[37,7],[[30,0,["updateSelected"]],[30,0,["lastUsedOption"]]],null]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],null]],[]]]],[]]]],[]]]],[]]],[1,"    "],[13],[1,"\\n"]],[]],null],[13],[1,"\\n\\n"],[41,[30,0,["showDiffModal"]],[[[1,"  "],[8,[39,9],null,[["@confirm","@diff","@oldValue","@newValue","@revert","@closeModal"],[[30,0,["confirmChanges"]],[30,0,["diff"]],[30,0,["initialValue"]],[30,0,["newSelectedText"]],[30,0,["undoAIAction"]],[28,[37,7],[[28,[37,10],[[30,0,["showDiffModal"]]],null],false],null]]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showThumbnailModal"]],[[[1,"  "],[8,[39,11],null,[["@thumbnails","@closeModal"],[[30,0,["thumbnailSuggestions"]],[28,[37,7],[[28,[37,10],[[30,0,["showThumbnailModal"]]],null],false],null]]],null],[1,"\\n"]],[]],null]],["option"],false,["did-insert","if","eq","d-button","each","-track-array","ai-helper-custom-prompt","fn","ai-helper-loading","modal/diff-modal","mut","modal/thumbnail-suggestions"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/ai-helper-context-menu.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"+kLlck0i",block:'[[[41,[30,0,["isAiBotChat"]],[[[1,"  "],[8,[39,1],null,[["@bodyClass"],[[30,0,["aiBotClasses"]]]],null],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"    "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[35,2],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null]],[],false,["if","d-section","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/topic-more-content/related-topics",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"6Oz8VQA3",block:'[[[11,0],[24,1,"related-topics"],[16,0,[29,["more-topics__list ",[52,[30,0,["hidden"]],"hidden"]]]],[24,"role","complementary"],[24,"aria-labelledby","related-topics-title"],[4,[38,1],[[30,0,["registerList"]]],null],[4,[38,2],[[30,0,["removeList"]]],null],[12],[1,"\\n  "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n    "],[1,[28,[35,3],["discourse_ai.related_topics.title"],null]],[1,"\\n  "],[13],[1,"\\n  "],[10,0],[14,0,"topics"],[12],[1,"\\n    "],[8,[39,4],null,[["@topics"],[[30,0,["relatedTopics"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],[],false,["if","did-insert","will-destroy","i18n","basic-topic-list"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/topic-more-content/related-topics.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/widgets/ai-bot-header-panel-wrapper",["exports","@ember/object","discourse/widgets/render-glimmer","discourse/widgets/widget","@ember/template-factory"],(function(e,t,i,o,s){"use strict"
var r
function n(e,t,i,o,s){var r={}
return Object.keys(o).forEach((function(e){r[e]=o[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(n((r=class extends o.default{buildAttributes(){return{"data-click-outside":!0}}html(){return[new i.default(this,"div.widget-component-connector",(0,s.createTemplateFactory)({id:"w7fEG46j",block:'[[[8,[39,0],null,[["@closePanel"],[[30,1,["closePanel"]]]],null]],["@data"],false,["ai-bot-header-panel"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/widgets/ai-bot-header-panel-wrapper.js",isStrictMode:!1}),{closePanel:this.closePanel})]}closePanel(){this.sendWidgetAction("hideAiBotPanel")}clickOutside(){this.closePanel()}}).prototype,"closePanel",[t.action],Object.getOwnPropertyDescriptor(r.prototype,"closePanel"),r.prototype),n(r.prototype,"clickOutside",[t.action],Object.getOwnPropertyDescriptor(r.prototype,"clickOutside"),r.prototype),r)})),define("discourse/plugins/discourse-ai/initializers/ai-bot-replies",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","discourse/plugins/discourse-ai/discourse/lib/ai-streamer","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],(function(e,t,i,o,s,r,n,a,l,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
function c(e){return e&&[-110,-111,-112,-113,-114,-115,-116].includes(e.id)}function d(e){const t=e.container.lookup("service:site-settings"),i=t.ai_bot_add_to_header?t.ai_bot_enabled_chat_bots.split("|").filter(Boolean):[]
i.length>0&&(e.attachWidgetAction("header","showAiBotPanel",(function(){this.state.botSelectorVisible=!0})),e.attachWidgetAction("header","hideAiBotPanel",(function(){this.state.botSelectorVisible=!1})),e.decorateWidget("header-icons:before",(e=>e.attach("header-dropdown",{title:"discourse_ai.ai_bot.shortcut_title",icon:"robot",action:"clickStartAiBotChat",active:!1,classNames:["ai-bot-button"]}))),1===i.length?e.attachWidgetAction("header","clickStartAiBotChat",(function(){(0,r.composeAiBotMessage)(i[0],e.container.lookup("service:composer"))})):e.attachWidgetAction("header","clickStartAiBotChat",(function(){this.sendWidgetAction("showAiBotPanel")})),e.addHeaderPanel("ai-bot-header-panel-wrapper","botSelectorVisible",(function(){return{}})))}function p(e){e.addPostMenuButton("cancel-gpt",(e=>{if(c(e.user))return{icon:"pause",action:"cancelStreaming",title:"discourse_ai.ai_bot.cancel_streaming",className:"btn btn-default cancel-streaming",position:"first"}})),e.attachWidgetAction("post","cancelStreaming",(function(){(0,t.ajax)(`/discourse-ai/ai-bot/post/${this.model.id}/stop-streaming`,{type:"POST"}).then((()=>{document.querySelector(`#post_${this.model.post_number}`).classList.remove("streaming")})).catch(i.popupAjaxError)})),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,a.default)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(c).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-2)},unsubscribe:function(){this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}function m(e){let t=null
e.decorateWidget("poster-name:after",(i=>{if(c(i.attrs.user))return t=t||e.container.lookup("controller:topic"),i.widget.attach("persona-flair",{topicController:t})})),(0,s.registerWidgetShim)("persona-flair","span.persona-flair",(0,u.createTemplateFactory)({id:"9jYzNJdM",block:'[[[1,[30,1,["topicController","model","ai_persona_name"]]]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-bot-replies.js",isStrictMode:!1}))}e.default={name:"discourse-ai-bot-replies",initialize(e){const t=e.lookup("service:site-settings"),i=e.lookup("service:current-user")
i?.ai_enabled_chat_bots&&(t.ai_bot_add_to_header&&(0,o.withPluginApi)("1.6.0",d),(0,o.withPluginApi)("1.6.0",p),(0,o.withPluginApi)("1.6.0",m),(0,o.withPluginApi)("1.22.0",(e=>function(e){const t=e.getCurrentUser()
if(!t||!t.ai_enabled_chat_bots)return
let i=async function(e){let{post:t,showFeedback:i}=e
t.post_number<=4?(await(0,l.default)(t.topic,1,t.post_number),i("discourse_ai.ai_bot.conversation_shared")):o.show(n.default,{model:t})}
e.addPostMenuButton("share",(e=>{if("private_message"===e.topic?.archetype&&(t.ai_enabled_chat_bots.any((t=>e.username===t.username))||!(e.user_id>-1200)))return{action:i,icon:"share",className:"post-action-menu__share",title:"discourse_ai.ai_bot.share",position:"first"}}))
const o=e.container.lookup("service:modal")}(e))))}}})),define("discourse/plugins/discourse-ai/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities"],(function(e,t,i,o,s,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,o.apiInitializer)("1.25.0",(e=>{const o={label:s.default.t("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},n=e.container.lookup("service:imageCaptionPopup"),a=e.container.lookup("service:site-settings"),l=e.container.lookup("service:composer"),u=e.container.lookup("service:app-events"),c=e.container.lookup("site:main")
a.ai_helper_enabled_features.includes("image_caption")&&e.addComposerImageWrapperButton(o.label,o.class,o.icon,(e=>{if(e.target.classList.contains("generate-caption")){const o=e.target.closest(".button-wrapper"),s=parseInt(o.getAttribute("data-image-index"),10),a=e.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
n.loading=!0,c.mobileView||(n.showPopup=!n.showPopup),e.target.classList.add("disabled"),(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:a}}).then((e=>{let{caption:t}=e
if(n.imageSrc=a,n.imageIndex=s,n.newCaption=t,c.mobileView){const e=l.model.reply.match(r.IMAGE_MARKDOWN_REGEX)[s],t=e.replace(r.IMAGE_MARKDOWN_REGEX,`![${n.newCaption}|$2$3$4]($5)`)
u.trigger("composer:replace-text",e,t)}})).catch(i.popupAjaxError).finally((()=>{n.loading=!1,e.target.classList.remove("disabled")}))}}))}))}))
define("discourse/plugins/discourse-ai/initializers/ai-semantic-search",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAI:ai-result"]})}))})),define("discourse/plugins/discourse-ai/initializers/related-topics",["exports","discourse/lib/plugin-api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-related-topics",initialize(e){const i=e.lookup("service:site-settings")
i.ai_embeddings_enabled&&i.ai_embeddings_semantic_related_topics_enabled&&(0,t.withPluginApi)("1.1.0",(e=>{e.modifyClass("model:post-stream",{pluginId:"discourse-ai",_setSuggestedTopics(e){this._super(...arguments),e.related_topics&&this.topic.setProperties({related_topics:e.related_topics})}})}))}}})),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]"])}}))

//# sourceMappingURL=discourse-ai-e016bb284e9719f7871a72313f33b812fbce82ce31c8e15e592746198831da16.map
//!

;
